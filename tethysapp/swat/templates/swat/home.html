{% extends "swat/base.html" %}
{% load staticfiles %}
{% load tethys_gizmos %}

{% block import_gizmos %}
    {% import_gizmo_dependency plotly_view %}
{% endblock %}

{% block styles %}
{{ block.super }}
<link rel="stylesheet" href="https://openlayers.org/en/v4.3.1/css/ol.css" type="text/css">
<link rel="stylesheet" href="https://openlayers.org/en/v4.6.5/css/ol.css" type="text/css">
<link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.6.4/css/bootstrap-datepicker3.css" rel="stylesheet"/>
{% endblock %}

{% block global_scripts %}
{{block.super}}
<script src="https://openlayers.org/en/v4.3.1/build/ol.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/1.3.4/chroma.min.js"></script>
<script src="https://code.highcharts.com/stock/highstock.js"></script>
<script src="https://code.highcharts.com/modules/data.js"></script>
<script src="https://code.highcharts.com/modules/drilldown.js"></script>
<script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.6.4/js/bootstrap-datepicker.js"></script>
{% endblock %}

{% block header_buttons %}
  <div class="header-button glyphicon-button" data-toggle="tooltip" data-placement="bottom" title="How-to">
    <a data-toggle="modal" data-target="#help-modal"><span class="glyphicon glyphicon-question-sign"></span></a>
  </div>
{% endblock %}

{% block app_navigation_items %}
  <br>
  <h6>Select Watershed</h6>
  {%gizmo watershed_select %}
  <div id="upload_file" class="btn-group upload" role="group">
      <a class="btn btn-primary" role="button" id="upload" href="{% url 'swat:add_watershed' %}">
          <span class="glyphicon glyphicon-cloud-upload"></span>&nbsp;&nbsp;Upload New Watershed </a>
  </div>
  <br>
  <div id="paramSelect">
    <h6>Select Parameters</h6>
    {% gizmo param_select %}
  </div>
  <br>
  <div class="monthDayToggle">
      <h6>Select Dates</h6>
    <label>
       <input id="toggle_switch" type="checkbox" checked data-toggle="toggle" data-on="Monthly" data-off="Daily" data-onstyle="success" data-offstyle="danger">
    </label>
  </div>
  <div class="input-group input-daterange">
    {% gizmo start_pick %}
    <div class="input-group-addon">to</div>
    {% gizmo end_pick %}
  </div>
  <br>
  <h6>Supplementary Layers</h6>
  <div class="btn-group btn-group-toggle" data-toggle="buttons">
    <label class="btn btn-primary">
      <input type="radio" class="radio" name="options" id="lulcOption" autocomplete="off"> Land Use/Land Cover
    </label>
    <label class="btn btn-primary">
      <input type="radio" class="radio" name="options" id="soilOption" autocomplete="off"> Soil
    </label>
    <label class="btn btn-primary active">
      <input type="radio" class="radio" name="options" id="noneOption" autocomplete="off" checked> None
    </label>
  </div>
  <!--<form>-->
    <!--<div class="radio">-->
      <!--<label><input type="radio" id="lulcradio" checked>Land Use/Land Cover</label>-->
    <!--</div>-->
    <!--<div class="radio">-->
      <!--<label><input type="radio" id="soilradio">Soil</label>-->
    <!--</div>  -->
  <!--</form>-->

{% endblock %}

{% block app_content %}

  <div id="map" class="map"></div>
{% endblock %}

{# Use the after_app_content block for modals #}
{% block after_app_content %}
  <!-- How-To Modal-->
  <div class="modal fade" id="help-modal" tabindex="-1" role="dialog" aria-labelledby="help-modal-label">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h5 class="modal-title" id="help-modal-label">SWAT Data Viewer</h5>
        </div>
        <div class="modal-body">
          <p>This web App displays an integration of multiple satellite-based earth observation systems,
            in-situ station data and spatial data with the Soil &amp; Water Assessment Tool (SWAT) hydrologic model
            employed in the Mekong River Basin region to improve the Lower Mekong River Basin regionâ€™s hydrological
            decision support system <a href='https://doi.org/10.3390/rs10060885'>(Mohammed et al., 2018)</a>.</p>
          <p>
          <h6>How To Use the App</h6>
            <ol>
              <li>Select the parameter that you want to view from the "Select Parameter" drop down menu</li>
              <li>Select the date that you want the time-series to start with in the "Select Start Date" date picker</li>
              <li>Select the date that you want the time-series to start with in the "Select End Date" date picker</li>
              <li>Select a stream on the map and a modal window will open containing your queried data</li>
            </ol>
          </p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>
        </div>
      </div>
    </div>
  </div>

  <!--Data Viewer Modal-->
  <div class="modal fade" id="ts-modal" tabindex="-1" role="dialog" aria-labelledby="ts-modal-label">
    <div class="modal-dialog" id="data-modal role="document">
      <div class="modal-content">
        <div id="tabs" class="modal-body">
          <!-- Nav tabs -->
          <ul class="nav nav-tabs" role="tablist">
            <li role="presentation" id="timeseries_link" class = "active"><a id="timeseries_tab_link" href="#timeseries_tab" aria-controls="forecast_tab" role="tab" data-toggle="tab">Time-Series</a></li>
            <li role="presentation" id="watershed_link"><a id="watershed_tab_link" href="#watershed_tab" aria-controls="watershed_tab" role="tab" data-toggle="tab">Watershed Data</a></li>
            <li role="presentation" id="nasaaccess_link"><a id="nasaaccess_tab_link" href="#nasaaccess_tab" aria-controls="nasaaccess_tab" role="tab" data-toggle="tab">NASAaccess</a></li>
          </ul>

          <!--Tab Panes-->
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane active" id="timeseries_tab">
              <div class="panel-body">
                <div class="flex-container-row"><img id="view-file-loading" class="view-file hidden" src="/static/swat/images/loader.gif" style="margin: auto"/></div>
                <h6 id="error" class="hidden"></h6>
                <div id="container" class="view_chart hidden"></div>
              </div>
            </div>
            <div role="tabpanel" class="tab-pane" id="watershed_tab">
              <div class="panel-body">
                <div id="watershed_data_container" class="watershed_data_container">
                  <div class="flex-container-row"><img id="view-pie-loading" class="view-file hidden" src="/static/swat/images/loader.gif" style="margin: auto"/></div>
                  <h6 id="error" class="hidden"></h6>
                  <div id="pieContainer" class="view_chart hidden"></div>
                </div>
                <div id="modal_map_container" class="modal_map_container">
                  <div id="modal_map" class="modal_map"></div>
                </div>
              </div>
            </div>
            <div role="tabpanel" class="tab-pane" id="nasaaccess_tab">
              <div class="panel-body">
                <div id="nasaaccess_form_container" class="nasaaccess_data_container">
                  <h6><strong>Select Date Range</strong></h6>
                    <div class="input-group input-nadaterange">
                        {% gizmo na_start_pick %}
                        <div class="input-group-addon">to</div>
                        {% gizmo na_end_pick %}
                    </div>
                    <h6><strong>Select NASAaccess Functions</strong></h6>
                    <table class="table table-striped">
                        <thead>
                          <tr>
                            <th></th>
                            <th>Function</th>
                            <th>Information</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td><input class="chk" type="checkbox" value="GLDASpolyCentroid"></td>
                            <td>GLDAS Poly Centroid</td>
                            <td>Generate air temperature input files as well as air temperature stations file from NASA GLDAS remote sensing products.</td>
                          </tr>
                          <tr>
                            <td><input class="chk" type="checkbox" value="GLDASwat"></td>
                            <td>GLDAS SWAT</td>
                            <td>Generate SWAT air temperature input files as well as air temperature stations file from NASA GLDAS remote sensing products.</td>
                          </tr>
                          <tr>
                            <td><input class="chk" type="checkbox" value="GPMpolyCentroid"></td>
                            <td>GPM Poly Centroid</td>
                            <td>Generate rainfall input files as well as rain station file from NASA GPM remote sensing products.</td>
                          </tr>
                          <tr>
                            <td><input class="chk" type="checkbox" value="GPMswat"></td>
                            <td>GPM SWAT</td>
                            <td>Generate SWAT rainfall input files as well as rain stations file from NASA GPM remote sensing products.</td>
                          </tr>
                        </tbody>
                    </table>

                <br>
                <button class="btn btn-primary" id="nasaaccess">Run NASAaccess</button>
                </div>
                <div id="nasaaccess_map_container" class="nasaaccess_map_container">
                  <div id="nasaaccess_map" class="nasaaccess_map"></div>
                </div>
              </div>
            </div>
          </div>

          <!--<div class="flex-container-row"><img id="view-file-loading" class="view-file hidden" src="/static/swat/images/loader.gif" style="margin: auto"/></div>-->
          <!--<h6 id="error" class="hidden"></h6>-->
          <!--<div id="container" class="view_chart hidden"></div>-->
        </div>
        <div class="modal-footer">
          <div class="download-buttons">
            <div id="download_csv" class="btn-group hidden" role="group">
              <a class="btn btn-success" role="button" id="submit-download-csv" href="{% url 'swat:download_csv' %}">
                <span class="glyphicon glyphicon-download-alt"></span>&nbsp;&nbsp;Download .csv</a>
            </div>
            <div id="download_ascii" class="btn-group hidden" role="group">
              <a class="btn btn-success" role="button" id="submit-download-ascii" href="{% url 'swat:download_ascii' %}">
                <span class="glyphicon glyphicon-download-alt"></span>&nbsp;&nbsp;Download ASCII</a>
            </div>
            <div id="lulc_compute" class="btn-group hidden" role="group">
              <a class="btn btn-success" role="button" id="lulc_comp">
                <span class="glyphicon glyphicon-grain"></span>&nbsp;&nbsp;Compute LULC Statistics</a>
            </div>
          </div>
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Contact Information Modal -->
  <div class="modal fade" id="cont-modal" tabindex="-1" role="dialog" aria-labelledby="cont-modal-label">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h5 class="modal-title" id="cont-modal-label">Contact Information</h5>
        </div>
        <div class="modal-body">
            <p>Depending on the watershed size and the date range you selected,
                the nasaaccess process may take some time.
                Please provide your email here and we will contact you with a
                6 digit access code for downloading your data when the process is complete.</p>
            <label for="id_email">Email Address:</label>
            <input id="id_email" type="email" placeholder="Email" size="30" required<input>
            <p>Your email will only remain in our database until your access code has been sent out.
                The access code you receive will then be valid for 3 days.</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" id="submit_email">Submit</button>
            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>


  <!--Upload Custom Watershed Modal-->
  <div class="modal fade" id="upload-modal" tabindex="-1" role="dialog" aria-labelledby="upload-modal-label">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4>Watershed Upload</h4>
          <!--<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>-->
        </div>
        <div class="modal-body">
          <div class="form-container">
            <form class="form" method="post" enctype="multipart/form-data" action="../upload/">
              {% csrf_token %}
              {{ watershedform.as_p }}
              <input type="submit" value="Submit">
            </form>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block app_actions %}
{% endblock %}